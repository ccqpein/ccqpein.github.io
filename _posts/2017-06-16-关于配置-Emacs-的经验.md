---
layout: post
title: 关于配置 Emacs 的经验
categories:
- blog
---

## 写在前面

前几天我的 Emacs 出了点小问题，觉得有必要把这两年来用 Emacs 的一些经验记录下来，一来是方便自己回忆，同时还能给后来人铺路。如果你已经入坑了，可以直接跳过下一节。

## 入坑
我已经忘了什么时候知道 Emacs 的了，也忘了是什么时候从 Sublime 切换到 Emacs 作为自己的主力编辑器。但是我记得我最开始看的一个教程中说，学习最好的方法就是直接上手做，这点我还是很同意的。并不只是编辑器，我觉得码农这行很多工具类的东西最好的学习方法都是直接用，不用起来的话书看一章忘一章，教程看十几篇结果还是用不起来。

扯远了，回到 Emacs，Emacs 的使用和一般工具不同，在开始时就有几个我认为的难点

+ 为什么要用 Emacs
+ 使用习惯的改变
+ 配置

这三个点有时候混在一起出现，导致从别的编辑器（比如 Sublime）切换到Emacs 的学习成本不停的增大，以至于从教程到放弃。

首先是为什么，如果我用 Sublime 用的很开心，Sublime 自带的插件管理也能支持拓展，高亮什么的也很好，为什么要换到一个从来没听过的老古董。第二，安装完后看教程发现 Emacs 鼓励用快捷键，结果快捷键和想象中好不一样，各种组合键，还不如用鼠标。第三，配置完全看不懂，是不是要学习一门新语言啊（Elisp），然后又开始问自己第一个问题，一种循环的概念。

第一个问题我解答不了，老实说我也不知道。第二个问题，我觉得很重要，因为习惯是很有力量的，而且 Emacs 对习惯的改变不像 `--version` 和 `-version` 或者 `-help` 和 `--help` 这种改变，而是直接改变使用鼠标的习惯，Emacs 设计的尽量让双手不离开键盘，这一点我在使用了一段时间后才发现好处，敲代码敲到一半换到触控板，是挺中断的，想必换到鼠标更甚（我没用鼠标）。然而，说新习惯的优点并不能减少习惯改变的难度，所以第二个问题也是无解的。

头两个问题不属于技术能解决的问题（第二个问题其实可以，用插件改变快捷键），我提出来的原因是希望每个想入坑的人做好心理准备，不是只有你一个人在入门的时候不停的怀疑人生，我也经历过，我不想做为一个布道者写这篇记录，如果你觉得没必要学，那就不用学，没啥大不了的。

第三个问题，配置，一些入门教程会告诉你直接用别人的配置，这样在你稍微能看懂 Elisp 配置前，尽可能的减少学习的阻力，把重点放到敲代码本身来。这点我是同意的，但是我个人有一点洁癖，我在[这篇](http://ccqpein.me/2016/03/10/关于-Lisp-的废话.html)里面有讲为什么我不喜欢用别人的配置。

如果你没有我这种洁癖，那么我上传了我自己的配置，你可以在[这里](https://github.com/ccqpein/ccQ-Emacs-d)看到如何安装。

文章接下来讲的是如何开始配置一个环境，我将假设你有用 Emacs 写过一点点东西，但是还是不懂如何从头开始配置一个环境。

## 配置阶段

Emacs 有很高的兼容性，如果你看很多使用 Emacs 的视频，会觉得特别酷炫，各种神奇的功能全部能集成进 Emacs。一些布道的文章会说 Emacs 拓展性炸裂，这话不假，然而如果我只想安安心心的敲代码，总不能让我自己写一个插件出来吧，那我如何配置一个基本可用的敲代码环境？

### 先Google

比如我想学一门新的语言，我直接在 Google 里面搜`语言名+Emacs+环境（配置）`（记得用英文），不出意外会有 EmacsWiki 的链接在前几条。EmacsWiki 会按照语言整理一些插件出来，并且会给一点插件的基础用法，记住这些插件的名称。

然后，回到 Google 往下翻博客类的文章，会有人写如何配置这门语言的环境，博客要注意发布时间，因为很多插件需要和单独的软件联动，而联动的软件的接口若干年过去可能有变化，所以不能只看一篇博客，而是要好多篇合在一起看。

### 整理信息

一般粗略看完 EmacsWiki 的介绍，几篇博客文章后，大概就知道一、两个插件是为这个语言准备的。我个人建议选择出境率高的，或者，一个一个点进代码库看，看哪个还有维护的迹象。注意，由于 Emacs 本身迭代就没有这么快，有一小部分插件可能几个月或者几年都没有维护，仍然不耽误使用，比如[google-this](https://github.com/Malabarba/emacs-google-this)。

如果是在新学一门语言前配置环境，可能有一个坑是关于**语言本身的管理工具和 Emacs 的联动**。因为没接触过这门语言，也没有用过这门语言的工具，所以有些教程中的 Emacs 和系统联动就看不懂他在说什么。这个后面会写，现在先忽视掉。

大概确定了要安装什么插件，以及哪篇教程看上去比较靠谱后，就可以开始下一步了。

### 开始配置

这里我用[这篇博客](http://tleyden.github.io/blog/2014/05/22/configure-emacs-as-a-go-editor-from-scratch/)来做例子，配置一个 Go 语言的环境。

一些负责任的博客会写的很全，比如会在开始时写如何安装 Emacs（我假设你已经知道了），在配置的代码阶段会写上：

```lisp
(require 'package)
(add-to-list 'package-archives
  '("melpa" . "http://melpa.milkbox.net/packages/") t)
```

这段代码是添加插件的安装源，如果以后要配置别的语言的话，这行就不停的被添加，其实只要添加一遍就好了，所以在配置环境的时候要**注意配置文件中的代码的重复。**

继续往下看能看到教程有写安装 `godoc`，这是个第三方插件，在学 Go 之前我们先忽视它，同时可以忽视的还有后面的 `godoc` 配置代码。

接着往下看，在自定义的 `go build` 这部分，坑在于代码对新手很不友好，没有配置过 Emacs 的人可能就掉坑里了，因为我们跳过了 gocode 的部分，而这部分的代码是加在了之前 gocode 的 hook 里面。所以这里有两个策略：

* 对于 Emacs 新手，跳过有 `hook` 的部分
* 对于有 Emacs 经验，但是对特定语言不熟的，可以斟酌一下。

这个教程的 part2 几乎可以完全忽略了，因为需要和第三方插件联动和添加 `hook` 

### 本阶段总结

目前为止，一个最小可用的 Go 环境差不多配置好了，看上去写了一大段只做了 找到教程 -> 复制粘贴 这个操作而已，因为跳过了干扰的部分。然而最开始配置的时候，我经常在 `go get` 安装新 Go 的插件和配置文件中切换，耗费了大量的时间，回过头来觉得很多步骤一开始并不必要。

这阶段注意点是：

1. 添加代码的时候，注意是不是已经有过重复的代码，尤其是`(require 'package)` 和 `(add-to-list args)` 这种只需要添加一次的命令。
2. 如果涉及需要安装第三方插件，如果认为知道它在干什么，可以先装，如果不知道，可以先跳过。
3. `hook` 后缀函数是把两个函数“勾”在一起，用于自定义一些配置，大部分是作者本身喜欢的配置，未来可以自己写，一开始也可以先忽略。

## 使用阶段

一个最小可用的环境好了以后，理论上就可以开始敲代码了，使用阶段分为两个阶段，一个是刚配置结束的测试阶段，一个是就是平时日常敲代码的阶段。

### 测试

刚配置好后需要看看配置是不是按照自己的意愿工作，比如关键字补全，高亮，颜色，以及其它一些你写在配置文件的功能。比如教程中配置的「自动gofmt」功能，就写一段缩进没对齐，括号风格不一致的代码，然后保存，看看是不是会自动进行排版，如果可以，说明测试就过了。

### 日常使用

我觉得编辑器的存在感应该降到最低，有且只有出问题的时候，才意识到它的存在。所以日常使用阶段除了回想快捷键以外，尽可能的专注于代码本身。等习惯了 Emacs 的操作，就会忘掉 Emacs 的存在了。

## 重温阶段

这一部分是用了一段特定语言后，当前环境已经用的很熟练了，就可以增加新的功能了。我个人是会没事闲的时候去搜搜看，每次都会发现点新内容，觉得自己喜欢的功能就加进去。所以重温是一个不定时的，增强现有功能的活动。

### 再 Google

可以再去 Google 一些当前环境的信息

+ 找一些 trick & tips
+ 点进去插件作者的 Github，阅读一遍作者写的README，看看有没有喜欢的、错过的功能
+ 也许会在作者的主页发现别的有意思的插件，来配合、增强当前插件功能

### 工具联动

可以重新看之前看过的教程，学会了 Go 的插件管理之后就可以知道 `go get` 的功能，同样也大概能猜到后面代码的目的。如果对 Emacs 有更多的了解，能看懂 `hook` 函数的功能，可以添加到自己的配置当中。

甚至有些功能我想在 Emacs 里面直接实现，而不想切换出去（懒死），我会搜有没有实现功能的插件。比如 Git，我就是特地去搜索有没有插件可以实现，现在我提交 Git 也不用切换出 Emacs。

之前忽略的所有功能，现在都可以慢慢加进自己的配置，会比一开始就做一个大而全的环境要容易实现。


## 后话

差不多每一次新配一个语言的环境我都是这个流程，还可以关注一下 Emacs 的 reddit 频道或者一些 Emacs 论坛。偶尔会学会一些小技巧。




