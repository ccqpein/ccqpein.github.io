---
layout: post
title: 编程语言和代码风格
categories:
- blog
---

## 写在前面
前段时间看到王垠的那篇[如何掌握所有的程序语言](http://www.yinwang.org/blog-cn/2017/07/06/master-pl)，结合我自己的经验来看，觉得写的还是相当可以的。但是，我在推上（或者是微博上？）说了，王垠在这里的观点形成了一个悖论，会很多种语言的程序员不需要看王垠的文章，脑子里就已经有了类似的观点，而看完这篇文章的人，不去学很多种语言也不会知道他在讲什么。王垠把别人想，但是说不出来的观点整理并写出来，所以还是不错的。

看完那篇文章后我就在想写这篇，忙于找工作面试入职，一直拖到现在。提前声明，和之前一样，这也只是我的个人想法经验，不具备普适性。

## 语言的共性问题
上面已经讲了，王垠把很多人想说但是说不出来（或者是不稀罕说）的事情说出来了。大部分语言所完成的事情都差不多，如同当年图灵和丘奇在大西洋两岸用各自的方法证明了可计算性，编程语言是告诉机器要去做什么的一种方式，换句话说是人类和机器交流的途径，无论你是用什么语言，其中那部分你想让机器去完成的事情应该都是一样的。我不止一次，在各种渠道看到「程序语言一通百通」的观点，结合语境来看，只有当他们和王垠这篇文章讲的是一个层面的东西时，才是站的住脚的。

然而，我猜大部分说这句话的人都只是找一个不去专门学一门语言的借口而已。

那么，既然我们表达给计算机的问题都一样，是不是编程语言也都一样呢？我举个例子，比如我说「这是个太阳」，英文"This is a sun"，这两句话中想表达的是一样的，所以一定会有一个名词「太阳」出现，王垠所讲的是，如果我们要表达这个意思，那么一定会存在一个名词，这个叫通用的特性。而把语言拿起来就用的程序员，就是知道这个特性，即使他不知道「太阳」用英文怎么讲，那么他用 Google 翻译过来就好了。放到程序员的例子，比如我要声明一个字典（哈希表），我就直接搜“dict” + 语言名，就好了。


## 语言的不同风格
上面讲了我认为王垠所讲的问题，有些想法我在[《这两年学编程语言中的一些微不足道的经验》](http://ccqpein.me/blog/2017/01/15/这两年学编程语言的微不足道的经验.html)有所提及，接下来要讲的是我认为不同语言对代码风格影响的不同，算是对之前那篇最后一段的补充。

因为程序语言发展了这么多年，很多语法和关键字都慢慢变成了标准，比如if、else等等。除了少部分设计确实独特的语言以外，大部分语言在语法上并不很难读。可能不止语法不难读，在程序员看不到的地方，实现方式可能都一样。不一样的地方在于，一些语言由于设计的不同，会产生不同「风格」的代码。如果常看 Python 文章的人，可能会看过类似「如何写出 Python 风格的代码」的文章，我很难在这里定义「风格」，就先假设风格确实存在，并且与语言相关。而我想说的可能更泛化一点，我想表达的是 `语言特性->语言风格->代码风格`，其中代码风格不局限于一门语言，而是所有语言，换言之，对一个程序员写别的语言的影响。

## 个人私货
### 被 Haskell 虐待
就我个人而言，Lisp、Haskell 都对我敲别的语言有巨大的影响，在我刚开始把算法题翻译成 Haskell 的时候，总是想着用C系那种对变量进行赋值的方法来改变变量的值，结果显然是写的痛苦万分。后来用了大量的时间搜索，重看之前的书，了解 Haskell 的设计。

我学 Haskell 的原因和 Lisp 差不多（见[《关于 Lisp 的废话》](http://ccqpein.me/2016/03/10/关于-Lisp-的废话.html)），听信了江湖传说：“用 Haskell 能写出没有 bug 的代码”、“只要编译器过了，就不会再有 bug 了”。Haskell 有很多诡异但是合理的设计，但是这一篇是讨论代码风格，就不讲别的了。

Haskell 对我代码风格最大的改变是对于递归的写法，用 Haskell 写递归很容易就写成尾递归了。而尾递归是每一步更新输入状态的，这点和我之前的习惯写法格格不入。

在 Haskell 之前我写递归是会把递归的函数值给中间变量的，这就不是尾递归，对于有尾递归优化的语言来讲就显不出优势来了。因为别的语言，比如 Python 可以利用作用域的层级来控制变量的访问顺序，Haskell 不行，每一次递归都是把输入的状态更新了一次。在习惯了这种写法后，我又去搜索了尾递归的原理，当然，Haskell 的设计是对的。

在没被 Haskell 虐待之前，我是很少写尾递归的，对尾递归也只限于知道有这个东西，但是从来没用过。在被虐待过后，很容易就能写出尾递归出来，几乎所有的递归现在我都尽量写成尾递归，甚至没有尾递归优化的语言。这里还有一个意外收获，学 Clojure 的时候，`loop-recur` 和 `recur` 关键字理解起来毫无难度。因为 JVM 没有尾递归优化，但是所有的尾递归都能写成 `while` 循环，Clojure 用语法的设计来帮助程序员实现尾递归，而这个语法风格和 Haskell 几乎一样的。

### 被 Lisp 虐待
在 Haskell 之前，学 Lisp 的时候对我代码风格的改变是`面条型代码->块状代码`，因为 Lisp 的代码语法设计就是一块一块组织，逻辑从外到里，非常简洁。然而我现在回看我最开始写的时候，还是沿用了之前的面条型代码，大量的使用 `progn` 和 `return-from` 来生产面条。这种写法并不匹配 Lisp 的语法，所以显得丑陋无比，而且可读性一塌糊涂，我现在看我那时的代码都有点恶心。

另外，面条型代码在 Lisp 中特别不好维护，想改一个部分就要改很多，如果不是编辑器帮忙画括号，简直要崩溃，而且代码极易失控。

这种生产恶心代码对我造成的不适，迫使我慢慢改变自己的代码风格，强迫自己写出 Lisp 风格的代码。在着手写之前就要想，最外层逻辑是什么，然后一步一步往细节写。最开始要声明什么变量？用 `loop` 还是 `do`？如同国内的应试教育，这种事情一开始难，想多了写多了就容易多了，后来写别的代码的时候自然而然的就这么想了。

这里要提一下，顺序性是程序语言的基本要素之一，但我认为这并不是生产面条型代码的理由。对于计算机来说，代码无论怎么写都是顺序运行的，不生产面条是对于程序员而言的，“块状”代码更可读，可好维护，逻辑更清晰。

## 最后
上面的两个例子不属于语言特性，而是不同编程语言对代码风格的影响，有的是语法产生的，有的是语言设计产生的，是一种被某种语言训练，并且可以迁移到别的语言的写代码、思考习惯。我认为，如果说掌握所有语言是掌握所有语言的特性，这些可以通过学不同语言找共同点了解，而某种语言的风格，只能通过学习这门语言来培养。

